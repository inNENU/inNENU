<import src="/base/page.wxml" />
<page-meta
  background-text-style="{{darkmode ? 'dark' : 'light'}}"
  background-color="{{color.bgColor}}"
  background-color-top="{{color.bgColorTop}}"
  background-color-bottom="{{color.bgColorBottom}}"
  root-background-color="{{color.bgColor}}"
/>
<scroll-view
  type="list"
  scroll-y
  class="{{theme}} {{size}} grey search-page"
  catch:scroll="onScrollViewScroll"
>
  <navbar nav="{{ { title: '搜索' } }}" />

  <search search-word="{{searchWord}}" catch:search="search" />

  <!-- 搜索结果 -->
  <block wx:if="{{results.length > 0}}">
    <view class="search-results-wrapper">
      <view class="results-header">
        <view class="results-title">搜索结果</view>
        <view class="results-count">共 {{total}} 个结果</view>
      </view>

      <block wx:for="{{results}}">
        <!-- 搜索结果标题 -->
        <view class="search-item-title">
          <block wx:for="{{item.title}}" wx:for-item="titlePart" wx:key="*this">
            <text class="{{titlePart[1] ? 'highlight' : ''}}"
              >{{titlePart[0]}}</text
            >
          </block>
        </view>

        <view
          class="search-item"
          hover-class="button-hover"
          data-url="{{'info?id=' + item.id + '&from=搜索'}}"
          catch:tap="$bindGo"
        >
          <view wx:if="{{item.header.length}}" class="search-item-header">
            <text
              wx:for="{{item.header}}"
              wx:for-item="part"
              class="{{part[1] ? 'highlighted' : ''}}"
              >{{part[0]}}</text
            >
          </view>
          <view wx:elif="{{!item.content.length}}" class="search-item-header">
            <text
              wx:for="{{item.title}}"
              wx:for-item="part"
              class="{{part[1] ? 'highlighted' : ''}}"
              >{{part[0]}}</text
            >
          </view>

          <!-- 搜索结果内容 -->
          <view wx:if="{{item.content.length }}" class="search-item-content">
            <text
              wx:for="{{item.content}}"
              wx:for-item="part"
              class="{{part[1] ? 'highlighted' : ''}}"
              >{{part[0]}}</text
            >
          </view>
        </view>
      </block>
    </view>
  </block>

  <!-- 加载状态 -->
  <view wx:elif="{{searching}}" class="loading-state">
    <view class="loading-spinner"></view>
    <text class="loading-text">搜索中...</text>
  </view>

  <!-- 搜索建议（当没有搜索词时） -->
  <block wx:elif="{{!searchWord}}">
    <view class="search-suggestions">
      <view class="suggestions-title">热门搜索</view>
      <view class="suggestion-tags">
        <view
          class="suggestion-tag"
          hover-class="button-hover"
          data-query="课程表"
          catch:tap="searchSuggestion"
          >课程表</view
        >
        <view
          class="suggestion-tag"
          hover-class="button-hover"
          data-query="成绩查询"
          catch:tap="searchSuggestion"
          >成绩查询</view
        >
        <view
          class="suggestion-tag"
          hover-class="button-hover"
          data-query="图书馆"
          catch:tap="searchSuggestion"
          >图书馆</view
        >
        <view
          class="suggestion-tag"
          hover-class="button-hover"
          data-query="校园卡"
          catch:tap="searchSuggestion"
          >校园卡</view
        >
        <view
          class="suggestion-tag"
          hover-class="button-hover"
          data-query="选课"
          catch:tap="searchSuggestion"
          >选课</view
        >
        <view
          class="suggestion-tag"
          hover-class="button-hover"
          data-query="考试安排"
          catch:tap="searchSuggestion"
          >考试安排</view
        >
        <view
          class="suggestion-tag"
          hover-class="button-hover"
          data-query="校历"
          catch:tap="searchSuggestion"
          >校历</view
        >
        <view
          class="suggestion-tag"
          hover-class="button-hover"
          data-query="邮箱"
          catch:tap="searchSuggestion"
          >邮箱</view
        >
      </view>
    </view>

    <view class="empty-state">
      <view class="empty-icon"></view>
      <view class="empty-title">开始搜索</view>
      <view class="empty-description">
        <text>输入关键词来搜索相关内容，支持搜索课程、功能、资料等。</text>
      </view>
    </view>
  </block>

  <!-- 空结果状态 -->
  <view wx:else class="empty-state">
    <view class="empty-icon"></view>
    <view class="empty-title">没有找到相关内容</view>
    <view class="empty-description">
      <text>请尝试使用其他关键词搜索，或检查输入是否正确。</text>
    </view>
  </view>

  <footer />

  <button
    class="scroll-top-button {{showBackToTop? 'show': ''}}"
    catch:tap="scrollTop"
  >
    <view class="icon" />
  </button>
</scroll-view>
