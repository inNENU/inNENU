<import src="/base/page.wxml" />
<page-meta
  background-text-style="{{darkmode ? 'dark' : 'light'}}"
  background-color="{{color.bgColor}}"
  background-color-top="{{color.bgColorTop}}"
  background-color-bottom="{{color.bgColorBottom}}"
  root-background-color="{{color.bgColor}}"
/>
<scroll-view
  type="list"
  scroll-y
  enable-flex
  class="{{theme}} {{size}} grey search-page"
  catch:scroll="onScrollViewScroll"
>
  <navbar nav="{{ { title: '搜索' } }}" />

  <search search-word="{{query}}" catch:search="onSearch" />

  <view class="content">
    <block wx:if="{{pageResults.length}}">
      <view class="page-results-wrapper">
        <view class="results-header">
          <view class="results-title">
            <text>相关功能</text>
          </view>
          <view class="results-count">
            <text>共 {{pageResults.length}} 个结果</text>
          </view>
        </view>
        <scroll-view type="list" scroll-x enable-flex class="page-result-list">
          <view
            wx:for="{{pageResults}}"
            class="page-result"
            hover-class="button-hover"
            data-url="{{item.url}}"
            catch:tap="$bindGo"
          >
            <image class="page-result-icon" src="{{icons[item.icon]}}" />
            <text class="page-result-text" overflow="ellipsis"
              >{{item.name}}</text
            >
          </view>
        </scroll-view>
      </view>
    </block>

    <!-- 搜索结果 -->
    <block wx:if="{{contentResults.length}}">
      <view class="content-results-wrapper">
        <view class="results-header">
          <view class="results-title">
            <text>搜索结果</text>
          </view>
          <view class="results-count">
            <text>共 {{total}} 个结果</text>
          </view>
        </view>

        <block wx:for="{{contentResults}}">
          <!-- 搜索结果标题 -->
          <view class="content-result-title">
            <text
              ><text
                wx:for="{{item.title}}"
                wx:for-item="part"
                class="{{part[1] ? 'highlighted' : ''}}"
                >{{part[0]}}</text
              ></text
            >
          </view>

          <view
            class="content-result"
            hover-class="button-hover"
            data-url="{{'info?id=' + item.id + '&from=搜索'}}"
            catch:tap="$bindGo"
          >
            <view wx:if="{{item.header.length}}" class="content-result-header">
              <text
                ><text
                  wx:for="{{item.header}}"
                  wx:for-item="part"
                  class="{{part[1] ? 'highlighted' : ''}}"
                  >{{part[0]}}</text
                ></text
              >
            </view>
            <view
              wx:elif="{{!item.content.length}}"
              class="content-result-header"
            >
              <text
                ><text
                  wx:for="{{item.title}}"
                  wx:for-item="part"
                  class="{{part[1] ? 'highlighted' : ''}}"
                  >{{part[0]}}</text
                ></text
              >
            </view>

            <!-- 搜索结果内容 -->
            <view
              wx:if="{{item.content.length }}"
              class="content-result-content"
            >
              <text
                ><text
                  wx:for="{{item.content}}"
                  wx:for-item="part"
                  class="{{part[1] ? 'highlighted' : ''}}"
                  >{{part[0]}}</text
                ></text
              >
            </view>
          </view>
        </block>
      </view>
    </block>

    <!-- 加载状态 -->
    <view wx:elif="{{searching}}" class="loading-state">
      <view class="loading-spinner"></view>
      <text class="loading-text">搜索中...</text>
    </view>

    <!-- 搜索建议（当没有搜索词时） -->
    <block wx:elif="{{!query}}">
      <view class="search-suggestions">
        <view class="suggestions-title">热门搜索</view>
        <view class="suggestions-wrapper">
          <view
            wx:for="{{suggestions}}"
            class="suggestion"
            hover-class="button-hover"
            data-query="{{item}}"
            catch:tap="searchSuggestion"
          >
            <text>{{item}}</text>
          </view>
        </view>
      </view>

      <view class="empty-state">
        <view class="empty-icon"></view>
        <view class="empty-title">开始搜索</view>
        <view class="empty-description">
          <text>输入关键词来搜索小程序内容</text>
        </view>
      </view>
    </block>

    <!-- 空结果状态 -->
    <view wx:else class="empty-state">
      <view class="empty-icon"></view>
      <view class="empty-title">没有找到相关内容</view>
      <view class="empty-description">
        <text>请检查搜索词是否准确，或尝试使用更精简的关键词搜索。</text>
      </view>
    </view>
  </view>

  <pagination
    wx:if="{{totalPages > 1}}"
    current="{{current}}"
    total="{{totalPages}}"
    wrapper-class="pagination-wrapper"
    catch:change="changePage"
  />

  <footer />

  <button
    class="scroll-top-button {{showBackToTop? 'show': ''}}"
    catch:tap="scrollTop"
  >
    <view class="icon" />
  </button>
</scroll-view>
