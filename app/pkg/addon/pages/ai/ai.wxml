<wxs module="utils" src="./ai.wxs"></wxs>
<page-meta
  background-text-style="{{darkmode ? 'dark' : 'light'}}"
  background-color="{{color.bgColor}}"
  background-color-top="{{color.bgColorTop}}"
  background-color-bottom="{{color.bgColorBottom}}"
  root-background-color="{{color.bgColor}}"
/>
<view class="{{theme}} {{size}} grey ai-page">
  <navbar nav="{{ { title: 'ä¸œå¸ˆæ™ºèƒ½ä½“' } }}" />

  <!-- èŠå¤©æ¶ˆæ¯åˆ—è¡¨ -->
  <scroll-view
    scroll-y
    enable-flex
    class="chat-list"
    scroll-into-view="msg-{{messages.length - 1}}"
    scroll-with-animation
  >
    <view
      wx:for="{{messages}}"
      wx:key="id"
      class="message-item"
      id="msg-{{index}}"
    >
      <view
        class="message {{item.type === 'user' ? 'user-message' : 'assistant-message'}}"
      >
        <view class="message-avatar">
          <text class="icon">{{item.type === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'}}</text>
        </view>
        <view class="message-content">
          <view class="message-text">{{item.text}}</view>
          <view class="message-time">{{utils.formatTime(item.timestamp)}}</view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="message-item">
      <view class="message assistant-message">
        <view class="message-avatar">
          <text class="icon">ğŸ¤–</text>
        </view>
        <view class="message-content">
          <view class="message-text loading-text">
            <text class="loading-dot">â—</text>
            <text class="loading-dot">â—</text>
            <text class="loading-dot">â—</text>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-area">
    <view class="input-container">
      <input
        class="message-input"
        placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."
        value="{{inputMessage}}"
        bindinput="onInputChange"
        confirm-type="send"
        bindconfirm="sendMessage"
        disabled="{{loading}}"
      />
      <button
        class="send-button {{inputMessage.length > 0 && !loading ? 'active' : ''}}"
        bindtap="sendMessage"
        disabled="{{!inputMessage.length || loading}}"
      >
        å‘é€
      </button>
    </view>

    <!-- åŠŸèƒ½æŒ‰é’® -->
    <view class="function-buttons">
      <button class="function-button" bindtap="clearMessages" size="mini">
        æ¸…ç©ºå¯¹è¯
      </button>
    </view>
  </view>

  <footer />
</view>
